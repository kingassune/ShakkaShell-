# CVE-to-Exploit Pipeline

ShakkaShell v2 features an automated CVE-to-exploit pipeline that searches multiple sources and synthesizes exploits using LLMs.

## Overview

The pipeline searches these sources:

| Source | Description |
|--------|-------------|
| **NVD** | NIST National Vulnerability Database - CVE details, CVSS scores |
| **Exploit-DB** | Verified exploits database |
| **GitHub** | PoC repositories and exploit code |
| **LLM Synthesis** | AI-generated exploit code when no existing exploit found |

## CLI Usage

```bash
# Basic CVE lookup
shakka exploit CVE-2024-1234

# Filter by source
shakka exploit CVE-2021-44228 --source exploit_db
shakka exploit CVE-2023-44487 --source github
shakka exploit CVE-2020-1472 --source nvd

# Show exploit code with syntax highlighting
shakka exploit CVE-2024-1234 --code

# Limit results
shakka exploit CVE-2024-1234 --limit 3

# Disable LLM synthesis (only search existing exploits)
shakka exploit CVE-2024-1234 --no-llm
```

## Example Output

```
╔══════════════════════════════════════════════════╗
║  CVE-2021-44228 - Apache Log4j RCE               ║
╠══════════════════════════════════════════════════╣
║  CVSS: 10.0 (Critical)                           ║
║  Affected: Apache Log4j 2.0-beta9 to 2.14.1      ║
║  Type: Remote Code Execution                     ║
╠══════════════════════════════════════════════════╣
║  Exploits Found: 5                               ║
║  [1] exploit-db/50592 (verified) ✓               ║
║  [2] github/kozmer/log4j-shell-poc               ║
║  [3] github/tangxiaofeng7/CVE-2021-44228        ║
║  [4] nuclei/cves/2021/CVE-2021-44228.yaml       ║
║  [5] LLM synthesis (confidence: 0.85)            ║
╠══════════════════════════════════════════════════╣
║  [D]ownload  [T]est  [G]enerate custom  [S]can   ║
╚══════════════════════════════════════════════════╝
```

## Python API

```python
from shakka.exploit import ExploitPipeline, ExploitSource

# Create pipeline
pipeline = ExploitPipeline()

# Search for exploits
results = await pipeline.search("CVE-2024-1234")

for result in results:
    print(f"Source: {result.source}")
    print(f"URL: {result.url}")
    print(f"Confidence: {result.confidence}")
    print(f"Verified: {result.verified}")
    if result.code:
        print(f"Code:\n{result.code}")
```

### Source-Specific Search

```python
from shakka.exploit import CVELookup, ExploitDBSearch, GitHubSearch

# NVD lookup
nvd = CVELookup()
cve_info = await nvd.lookup("CVE-2024-1234")
print(f"CVSS: {cve_info.cvss_score}")

# Exploit-DB search
exploitdb = ExploitDBSearch()
exploits = await exploitdb.search("CVE-2024-1234")

# GitHub PoC search  
github = GitHubSearch()
pocs = await github.search("CVE-2024-1234")
```

## LLM Synthesis

When no existing exploit is found, the pipeline can synthesize one:

```python
from shakka.exploit import ExploitPipeline

pipeline = ExploitPipeline(enable_llm_synthesis=True)

# This will use LLM if no existing exploit found
results = await pipeline.search("CVE-2024-9999", synthesize=True)

for result in results:
    if result.source == ExploitSource.LLM:
        print("LLM-generated exploit:")
        print(result.code)
        print(f"Confidence: {result.confidence}")
```

## Safety Checks

The pipeline includes safety checks for dangerous patterns:

```python
from shakka.exploit import ExploitPipeline

pipeline = ExploitPipeline(safety_checks=True)

# Exploit code is scanned for dangerous patterns
results = await pipeline.search("CVE-2024-1234")

for result in results:
    if result.safety_warnings:
        print("⚠️ Safety warnings:")
        for warning in result.safety_warnings:
            print(f"  - {warning}")
```

## Data Models

```python
from shakka.exploit import ExploitResult, ExploitSource, CVSSScore

# ExploitResult
result = ExploitResult(
    cve_id="CVE-2024-1234",
    source=ExploitSource.EXPLOIT_DB,
    url="https://exploit-db.com/exploits/50383",
    title="Apache Path Traversal RCE",
    description="Remote code execution via path traversal",
    code="#!/usr/bin/python3\n...",
    confidence=0.95,
    verified=True,
    cvss=CVSSScore(
        score=9.8,
        vector="CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H"
    )
)
```

## Configuration

```yaml
# config.yaml
exploit:
  sources:
    - nvd
    - exploit_db
    - github
    - llm
  enable_llm_synthesis: true
  safety_checks: true
  max_results: 10
  
  # NVD API (rate limited without key)
  nvd_api_key: ${NVD_API_KEY}
  
  # GitHub token for higher rate limits
  github_token: ${GITHUB_TOKEN}
```

## See Also

- [CLI Reference](cli.md)
- [Safety Layer](safety.md)
- [Multi-Agent System](agents.md)
